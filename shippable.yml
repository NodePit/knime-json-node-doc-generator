# Language setting
language: java

# Version number
jdk:
  - oraclejdk8

integrations:
  key:
    - integrationName: nodepit
      type: pemKey

build:
  cache: true
  cache_dir_list:
    - $HOME/.m2
  ci:
    - if [ -d $HOME/.m2 ]; then du -sh $HOME/.m2; fi

    # maven build
    - mvn -V -B clean install

    # only use -P uploadRepo when (1) on master or release branch, (2) no pull request
    - >
      if [[ "$BRANCH" =~ ^(master|release/.+)$ ]] && [ "$IS_PULL_REQUEST" == false ]; then
        mkdir -p ~/.ssh &&
        echo -e "Host *\n\tStrictHostKeyChecking no\n\n" > ~/.ssh/config &&
        user_host=debian@nodepit.com &&
        label=${BRANCH#release/} &&
        dest_directory=/home/debian/nodepit/download/files/jsondocgen/$label &&
        ssh-agent bash -c "ssh-add /tmp/ssh/nodepit && ssh $user_host 'mkdir -p $dest_directory' && scp -rp de.philippkatz.knime.jsondocgen.update/target/repository/* $user_host:$dest_directory";
      fi
